<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifqy Al-Quran Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* BASE THEME VARIABLES */
        :root { --brand-color: #059669; --brand-grad: linear-gradient(135deg, #059669 0%, #064e3b 100%); --bg-color: #0b1414; --text-color: #e2e8f0; }
        
        /* THEME OVERRIDES */
        body.theme-blue { --brand-color: #3b82f6; --brand-grad: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); --bg-color: #0f172a; }
        body.theme-purple { --brand-color: #8b5cf6; --brand-grad: linear-gradient(135deg, #8b5cf6 0%, #5b21b6 100%); --bg-color: #1e1b4b; }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-color); scroll-behavior: smooth; transition: background-color 0.5s ease; }
        
        .arabic { font-family: 'Amiri', serif; line-height: 2.8; text-align: right; direction: rtl; transition: all 0.3s ease; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .gradient-brand { background: var(--brand-grad); }
        .hidden { display: none; }
        .loader { width: 30px; height: 30px; border: 3px solid var(--brand-color); border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* SLIDER STYLE */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--brand-color); cursor: pointer; margin-top: -6px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px; }

        /* HAFALAN MODE STYLES */
        .blur-mode { filter: blur(8px); opacity: 0.1; user-select: none; }
        .reveal-mode { filter: blur(0); opacity: 1; }
        
        /* ANIMASI KIBLAT */
        .compass-dial { transition: transform 0.5s cubic-bezier(0.4, 2, 0.4, 0.8); }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen relative">

    <div id="home-page" class="p-5 pb-32">
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 gradient-brand rounded-xl flex items-center justify-center font-bold text-white shadow-lg">R</div>
                <div>
                    <h1 class="font-bold text-lg leading-tight">Rifqy Al-Quran</h1>
                    <p id="jam-digital" class="text-[10px] font-bold tracking-widest opacity-80 text-emerald-400">00:00:00</p>
                </div>
            </div>
            <div id="hijri-now" class="text-right text-[10px] font-bold opacity-60 uppercase">...</div>
        </header>

        <div class="glass p-4 rounded-2xl mb-6">
            <div class="flex justify-between items-center text-center overflow-x-auto gap-4 no-scrollbar">
                <div class="min-w-[50px]"><p class="text-[8px] opacity-50 uppercase">Subuh</p><p id="sholat-subuh" class="text-xs font-bold">--:--</p></div>
                <div class="min-w-[50px]"><p class="text-[8px] opacity-50 uppercase">Dzuhur</p><p id="sholat-dzuhur" class="text-xs font-bold">--:--</p></div>
                <div class="min-w-[50px]"><p class="text-[8px] opacity-50 uppercase">Ashar</p><p id="sholat-ashar" class="text-xs font-bold">--:--</p></div>
                <div class="min-w-[50px]"><p class="text-[8px] opacity-50 uppercase">Maghrib</p><p id="sholat-maghrib" class="text-xs font-bold">--:--</p></div>
                <div class="min-w-[50px]"><p class="text-[8px] opacity-50 uppercase">Isya</p><p id="sholat-isya" class="text-xs font-bold">--:--</p></div>
            </div>
        </div>

        <div class="grid grid-cols-4 gap-3 mb-6">
            <div onclick="openTasbih()" class="glass p-2 rounded-2xl flex flex-col items-center justify-center h-20 active:scale-95 transition cursor-pointer">
                <div class="text-xl mb-1">üìø</div><div class="text-[8px] font-bold">Tasbih</div>
            </div>
            <div onclick="openAsmaul()" class="glass p-2 rounded-2xl flex flex-col items-center justify-center h-20 active:scale-95 transition cursor-pointer">
                <div class="text-xl mb-1">‚ú®</div><div class="text-[8px] font-bold">Asmaul</div>
            </div>
            <div onclick="openZakat()" class="glass p-2 rounded-2xl flex flex-col items-center justify-center h-20 active:scale-95 transition cursor-pointer">
                <div class="text-xl mb-1">üí∞</div><div class="text-[8px] font-bold">Zakat</div>
            </div>
            <div onclick="openKiblat()" class="glass p-2 rounded-2xl flex flex-col items-center justify-center h-20 active:scale-95 transition cursor-pointer">
                <div class="text-xl mb-1">üß≠</div><div class="text-[8px] font-bold">Kiblat</div>
            </div>
            <div onclick="openDoa()" class="glass p-2 rounded-2xl flex flex-col items-center justify-center h-20 active:scale-95 transition cursor-pointer col-span-2">
                <div class="text-xl mb-1">ü§≤</div><div class="text-[8px] font-bold">Doa Harian</div>
            </div>
            <div onclick="toggleTheme()" class="glass p-2 rounded-2xl flex flex-col items-center justify-center h-20 active:scale-95 transition cursor-pointer col-span-2">
                <div class="text-xl mb-1">üé®</div><div class="text-[8px] font-bold">Ganti Tema</div>
            </div>
        </div>

        <div class="gradient-brand p-6 rounded-[2rem] mb-8 relative overflow-hidden shadow-xl">
            <div class="relative z-10 text-white">
                <p class="text-xs opacity-80 mb-1 italic">Terakhir Baca</p>
                <h2 id="last-surah-name" class="text-2xl font-bold mb-1 underline">Al-Fatihah</h2>
                <p id="last-surah-info" class="text-sm opacity-70 mb-5">Ayat No: 1</p>
                <button onclick="resumeReading()" class="bg-white text-black px-6 py-2 rounded-full font-bold text-sm shadow-md active:scale-95 transition">Lanjutkan ></button>
            </div>
        </div>

        <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold flex items-center gap-2 text-sm">Daftar Surat</h3>
            <input type="text" id="search-input" onkeyup="searchSurah()" placeholder="Cari..." class="bg-white/5 border border-white/10 rounded-lg py-1 px-3 text-xs w-24 outline-none">
        </div>
        <div id="surah-list" class="space-y-3"></div>
    </div>

    <div id="detail-page" class="hidden min-h-screen">
        <nav class="sticky top-0 p-4 glass flex items-center justify-between z-50 backdrop-blur-xl border-b border-white/5">
            <div class="flex items-center gap-3">
                <button onclick="showHome()" class="text-xl">‚Üê</button>
                <div onclick="showSurahInfo()" class="cursor-pointer">
                    <h2 id="current-surah-name" class="font-bold text-sm leading-none flex items-center gap-1">... <span class="text-[8px] bg-white/10 px-1 rounded">INFO</span></h2>
                    <p id="current-surah-info" class="text-[8px] opacity-60 mt-0.5 uppercase"></p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="toggleGlobalHafalan()" id="btn-hafalan-global" class="text-[10px] border border-white/20 px-2 py-1 rounded-full text-gray-400">üß† HAFALAN OFF</button>
                <button onclick="toggleAutoScroll()" id="btn-autoscroll" class="text-[10px] border border-white/20 px-2 py-1 rounded-full text-gray-400">‚á© AUTO</button>
                <button onclick="stopAudio()" id="btn-stop-audio" class="hidden text-[10px] bg-red-900/50 text-red-200 px-2 py-1 rounded-md font-bold">STOP</button>
                <button onclick="toggleJumpAyat()" class="text-lg font-bold">#</button>
                <button onclick="toggleSettingsMenu()" class="text-xl">‚ãÆ</button>
            </div>
        </nav>

        <div id="jump-ayat-box" class="hidden fixed top-20 left-1/2 -translate-x-1/2 glass p-4 rounded-2xl z-50 flex gap-2 shadow-2xl">
            <input type="number" id="input-ayat" placeholder="No Ayat" class="bg-white/10 border border-white/20 rounded-lg px-3 py-1 text-xs w-20 outline-none">
            <button onclick="doJump()" class="gradient-brand text-white px-4 py-1 rounded-lg text-xs font-bold">Go</button>
        </div>

        <div id="settings-menu" class="hidden fixed top-16 right-5 w-56 glass p-5 rounded-2xl z-[60] shadow-2xl">
            <h4 class="text-[10px] font-bold text-emerald-500 mb-3 uppercase tracking-widest">Tampilan</h4>
            <div class="space-y-4 text-white text-[10px]">
                <div>
                    <div class="flex justify-between mb-1"><label>Ukuran Font Arab</label><span id="font-val">30px</span></div>
                    <input type="range" min="20" max="60" value="30" oninput="changeFontSize(this.value)">
                </div>
                <hr class="border-white/10">
                <div class="flex justify-between items-center"><label>Teks Latin</label><input type="checkbox" id="set-latin" onchange="toggleFitur()" checked></div>
                <div class="flex justify-between items-center"><label>Terjemahan</label><input type="checkbox" id="set-translate" onchange="toggleFitur()" checked></div>
            </div>
        </div>

        <div id="ayats-container" class="p-5 space-y-8 pb-32"></div>
    </div>

    <div id="kiblat-modal" class="hidden fixed inset-0 bg-black/95 z-[100] flex flex-col items-center justify-center p-5 text-center">
        <button onclick="closeModal('kiblat-modal')" class="absolute top-10 right-10 text-3xl">√ó</button>
        <h2 class="text-emerald-500 font-bold mb-4 text-xl">Arah Kiblat</h2>
        
        <div class="relative w-64 h-64 rounded-full border-4 border-gray-700 flex items-center justify-center shadow-[0_0_50px_rgba(16,185,129,0.1)] mb-8">
            <div id="compass-plate" class="compass-dial w-full h-full rounded-full absolute flex items-center justify-center">
                 <div class="absolute top-2 font-bold text-red-500 text-lg">N</div>
                 <div class="absolute bottom-2 font-bold text-gray-500 text-xs">S</div>
                 <div class="absolute left-2 font-bold text-gray-500 text-xs">W</div>
                 <div class="absolute right-2 font-bold text-gray-500 text-xs">E</div>
                 <div class="absolute w-1 h-32 bg-emerald-500 top-1/2 left-1/2 -translate-x-1/2 origin-top" style="transform: rotate(295deg); opacity: 0.5;"></div>
                 <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-emerald-500 text-2xl font-bold" style="transform: translate(90px, -45px);">üïã</div>
            </div>
            <div class="w-1 h-10 bg-white absolute top-0 left-1/2 -translate-x-1/2 rounded-b-full z-10"></div>
        </div>
        
        <button onclick="startCompass()" class="gradient-brand text-white px-6 py-2 rounded-full font-bold text-xs shadow-lg">Mulai Kompas</button>
        <p class="mt-4 text-[10px] text-gray-400 max-w-xs">Tekan "Mulai", lalu putar HP Anda sampai panah hijau (üïã) sejajar dengan jarum putih di atas.</p>
    </div>

    <div id="zakat-modal" class="hidden fixed inset-0 bg-black/95 z-[100] flex items-center justify-center p-6">
        <div class="glass w-full p-6 rounded-3xl relative">
            <button onclick="closeModal('zakat-modal')" class="absolute top-4 right-4 text-xl">√ó</button>
            <h2 class="text-xl font-bold mb-4">Kalkulator Zakat</h2>
            <input type="number" id="harta-val" placeholder="Total Harta (Rp)" class="w-full bg-white/10 p-3 rounded-xl mb-4 outline-none text-white">
            <button onclick="hitungZakat()" class="w-full gradient-brand py-3 rounded-xl font-bold mb-4 text-white">Hitung 2.5%</button>
            <div id="zakat-result" class="text-center font-bold text-emerald-400"></div>
        </div>
    </div>

    <div id="tasbih-modal" class="hidden fixed inset-0 bg-black/95 z-[100] flex flex-col items-center justify-center p-10">
        <button onclick="closeModal('tasbih-modal')" class="absolute top-10 right-10 text-3xl">√ó</button>
        <div id="tasbih-count" class="text-8xl font-black mb-10 text-white">0</div>
        <button onclick="countTasbih()" class="w-48 h-48 gradient-brand rounded-full shadow-lg text-white font-bold text-xl active:scale-90 transition">TEKAN</button>
        <button onclick="resetTasbih()" class="mt-10 text-gray-500 underline text-xs">Reset</button>
    </div>

    <div id="asmaul-modal" class="hidden fixed inset-0 bg-black/95 z-[100] p-5 overflow-y-auto">
        <div class="flex justify-between items-center mb-6 sticky top-0 bg-black/95 py-4 border-b border-white/10">
            <h2 class="font-bold text-xl">Asmaul Husna</h2><button onclick="closeModal('asmaul-modal')" class="text-3xl">√ó</button>
        </div>
        <div id="asmaul-list" class="grid grid-cols-2 gap-3 pb-10"></div>
    </div>
    <div id="doa-modal" class="hidden fixed inset-0 bg-black/95 z-[100] p-5 overflow-y-auto">
        <div class="flex justify-between items-center mb-6 sticky top-0 bg-black/95 py-4 border-b border-white/10">
            <h2 class="font-bold text-xl">Doa Harian</h2><button onclick="closeModal('doa-modal')" class="text-3xl">√ó</button>
        </div>
        <div id="doa-list" class="space-y-4 pb-10"></div>
    </div>
    
    <div id="info-modal" class="hidden fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-5">
        <div class="glass w-full max-w-sm p-6 rounded-2xl relative">
            <button onclick="closeModal('info-modal')" class="absolute top-4 right-4 text-xl">√ó</button>
            <h3 id="info-title" class="font-bold text-emerald-400 mb-4 text-lg">Info Surat</h3>
            <p id="info-content" class="text-xs text-gray-300 leading-relaxed text-justify">...</p>
        </div>
    </div>

    <script>
        // CONFIG & STATE
        let surahFullData = [], currentSurahId = 1, currentSurahData = null;
        let config = { trans: true, latin: true, fontSize: 30 };
        let isGlobalHafalan = false;
        let activeAudio = null, ayatAudioList = [];
        let autoScrollInterval = null;
        let lastRead = JSON.parse(localStorage.getItem('lastRead')) || { id: 1, name: 'Al-Fatihah', ayat: 1 };
        
        // THEME LOGIC
        const themes = ['', 'theme-blue', 'theme-purple'];
        let currentTheme = 0;
        function toggleTheme() {
            currentTheme = (currentTheme + 1) % themes.length;
            document.body.className = "max-w-md mx-auto min-h-screen relative " + themes[currentTheme];
        }

        // --- CORE: QURAN DATA ---
        async function getSurahList() {
            const res = await fetch('https://api.quran.gading.dev/surah');
            const data = await res.json();
            surahFullData = data.data;
            renderSurahList(surahFullData);
        }

        async function viewSurah(id) {
            currentSurahId = id;
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('detail-page').classList.remove('hidden');
            const container = document.getElementById('ayats-container');
            container.innerHTML = '<div class="text-center py-20"><span class="loader"></span></div>';
            
            try {
                const res = await fetch(`https://api.quran.gading.dev/surah/${id}`);
                const data = await res.json();
                currentSurahData = data.data;
                const surah = data.data;
                
                container.innerHTML = '';
                ayatAudioList = [];
                
                document.getElementById('current-surah-name').innerHTML = `${surah.name.transliteration.id}`;
                document.getElementById('current-surah-info').innerText = `${surah.numberOfVerses} AYAT ‚Ä¢ ${surah.revelation.id}`;

                // Bismillah (kecuali Al-Fatihah & At-Taubah)
                if(id !== 1 && id !== 9) container.innerHTML += `<div class="text-center mb-8"><p class="arabic text-3xl text-emerald-500">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê</p></div>`;

                surah.verses.forEach((v, idx) => {
                    ayatAudioList[idx] = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${v.number.inQuran}.mp3`;
                    const noteKey = `note-${id}-${v.number.inSurah}`;
                    const savedNote = localStorage.getItem(noteKey) || "";
                    
                    container.innerHTML += `
                        <div id="ayat-box-${idx}" class="relative pb-6 border-b border-white/5 transition-all group">
                            <div class="flex justify-between items-start mb-4">
                                <span class="bg-white/10 text-white font-bold text-[10px] w-8 h-8 rounded-lg flex items-center justify-center">${v.number.inSurah}</span>
                                
                                <div class="relative">
                                    <button onclick="toggleAyatMenu(${idx})" class="text-xl px-2 opacity-60 hover:opacity-100">‚ãÆ</button>
                                    
                                    <div id="menu-ayat-${idx}" class="hidden absolute right-0 top-6 w-40 glass bg-black/90 rounded-xl z-10 shadow-xl overflow-hidden text-[10px]">
                                        <button onclick="playAudio(${idx})" class="w-full text-left px-4 py-3 hover:bg-white/10 border-b border-white/5 flex items-center gap-2">‚ñ∂Ô∏è Play Audio</button>
                                        <button onclick="saveProgress(${id},'${surah.name.transliteration.id}',${v.number.inSurah})" class="w-full text-left px-4 py-3 hover:bg-white/10 border-b border-white/5 flex items-center gap-2">üìå Tandai</button>
                                        <button onclick="toggleMic(${idx})" id="btn-mic-${idx}" class="w-full text-left px-4 py-3 hover:bg-white/10 border-b border-white/5 flex items-center gap-2">üé§ Mic (Intip)</button>
                                        <button onclick="toggleNote(${idx})" class="w-full text-left px-4 py-3 hover:bg-white/10 flex items-center gap-2">üìù Catatan</button>
                                    </div>
                                </div>
                            </div>

                            <p id="arab-${idx}" class="arabic text-white mb-4 ${isGlobalHafalan ? 'blur-mode' : ''}" style="font-size:${config.fontSize}px">${v.text.arab}</p>
                            
                            <div id="trans-box-${idx}">
                                ${config.latin ? `<p class="text-[11px] text-emerald-400 italic mb-2 leading-relaxed">${v.text.transliteration.en}</p>` : ''}
                                ${config.trans ? `<p class="text-sm text-gray-400 font-light leading-relaxed">${v.translation.id}</p>` : ''}
                            </div>

                            <div id="note-box-${idx}" class="${savedNote ? '' : 'hidden'} mt-4">
                                <textarea onchange="saveNote(${id}, ${v.number.inSurah}, this.value)" placeholder="Tulis catatan..." class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-xs outline-none focus:border-emerald-500 transition h-20">${savedNote}</textarea>
                            </div>
                        </div>`;
                });
            } catch (e) { container.innerHTML = "Error loading."; }
        }

        // --- MENU & HAFALAN LOGIC ---
        function toggleAyatMenu(idx) {
            // Tutup semua menu lain dulu
            document.querySelectorAll('[id^="menu-ayat-"]').forEach(el => {
                if(el.id !== `menu-ayat-${idx}`) el.classList.add('hidden');
            });
            document.getElementById(`menu-ayat-${idx}`).classList.toggle('hidden');
        }

        function toggleGlobalHafalan() {
            isGlobalHafalan = !isGlobalHafalan;
            const btn = document.getElementById('btn-hafalan-global');
            
            if(isGlobalHafalan) {
                btn.innerText = "üß† HAFALAN ON";
                btn.classList.add('bg-emerald-500', 'text-black');
                // Blur semua
                document.querySelectorAll('.arabic').forEach(el => el.classList.add('blur-mode'));
            } else {
                btn.innerText = "üß† HAFALAN OFF";
                btn.classList.remove('bg-emerald-500', 'text-black');
                // Unblur semua
                document.querySelectorAll('.arabic').forEach(el => {
                    el.classList.remove('blur-mode', 'reveal-mode');
                });
                // Reset tombol mic status
                document.querySelectorAll('[id^="btn-mic-"]').forEach(b => b.innerHTML = "üé§ Mic (Intip)");
            }
        }

        function toggleMic(idx) {
            const el = document.getElementById(`arab-${idx}`);
            const btn = document.getElementById(`btn-mic-${idx}`);
            
            // Toggle Reveal class
            if (el.classList.contains('reveal-mode')) {
                el.classList.remove('reveal-mode');
                btn.innerHTML = "üé§ Mic (Intip)";
                btn.classList.remove('text-emerald-400');
            } else {
                el.classList.add('reveal-mode');
                btn.innerHTML = "üé§ Mic (ON)";
                btn.classList.add('text-emerald-400');
            }
            toggleAyatMenu(idx); // Tutup menu setelah klik
        }

        function toggleNote(idx) {
            document.getElementById(`note-box-${idx}`).classList.toggle('hidden');
            toggleAyatMenu(idx);
        }
        
        function saveNote(sId, aId, val) { localStorage.setItem(`note-${sId}-${aId}`, val); }

        // --- AUDIO ---
        function playAudio(idx) {
            stopAudio();
            toggleAyatMenu(idx);
            activeAudio = new Audio(ayatAudioList[idx]);
            const box = document.getElementById(`ayat-box-${idx}`);
            box.classList.add('bg-white/5', 'rounded-xl');
            document.getElementById('btn-stop-audio').classList.remove('hidden');
            
            activeAudio.play();
            activeAudio.onended = () => {
                box.classList.remove('bg-white/5');
                if(idx < ayatAudioList.length - 1) playAudio(idx + 1);
                else stopAudio();
            };
        }

        function stopAudio() {
            if(activeAudio) { activeAudio.pause(); activeAudio = null; }
            document.getElementById('btn-stop-audio').classList.add('hidden');
            document.querySelectorAll('[id^="ayat-box-"]').forEach(el => el.classList.remove('bg-white/5', 'rounded-xl'));
        }

        // --- KIBLAT LOGIC (Orientation API) ---
        function openKiblat() { document.getElementById('kiblat-modal').classList.remove('hidden'); }
        
        function startCompass() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                // iOS 13+ requires permission
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                        } else { alert("Izin kompas ditolak."); }
                    })
                    .catch(console.error);
            } else {
                // Android / Non-iOS 13+
                window.addEventListener('deviceorientation', handleOrientation);
            }
        }

        function handleOrientation(e) {
            // alpha: rotation around z-axis (compass direction)
            // webkitCompassHeading: for iOS
            let compass = e.webkitCompassHeading || Math.abs(e.alpha - 360);
            
            // Rotate the plate so North matches visual North
            // We want the PLATE to rotate so "N" points to real North.
            document.getElementById('compass-plate').style.transform = `rotate(-${compass}deg)`;
        }

        // --- UTILS & CORE ---
        function saveProgress(id, name, ayat) {
            lastRead = { id, name, ayat };
            localStorage.setItem('lastRead', JSON.stringify(lastRead));
            alert('Ditandai!');
            updateLastReadUI();
            toggleAyatMenu(ayat - 1); // Adjust index logic if needed, usually ayat-1
        }
        
        function resumeReading() {
            viewSurah(lastRead.id).then(() => {
                setTimeout(() => {
                    const el = document.getElementById(`ayat-box-${lastRead.ayat - 1}`);
                    if(el) el.scrollIntoView({behavior:'smooth', block:'center'});
                }, 1000);
            });
        }
        
        function updateLastReadUI() {
            document.getElementById('last-surah-name').innerText = lastRead.name;
            document.getElementById('last-surah-info').innerText = `Ayat No: ${lastRead.ayat}`;
        }
        
        function renderSurahList(data) {
            const c = document.getElementById('surah-list'); c.innerHTML = '';
            data.forEach(s => {
                c.innerHTML += `<div onclick="viewSurah(${s.number})" class="glass p-4 rounded-2xl flex justify-between items-center cursor-pointer active:scale-95 transition">
                    <div class="flex items-center gap-4">
                        <div class="w-8 h-8 flex items-center justify-center bg-white/10 rounded-lg font-bold text-xs">${s.number}</div>
                        <div><h4 class="font-bold text-sm">${s.name.transliteration.id}</h4><p class="text-[9px] opacity-50 uppercase">${s.numberOfVerses} Ayat</p></div>
                    </div>
                    <div class="arabic text-xl text-emerald-500">${s.name.short}</div>
                </div>`;
            });
        }

        function toggleAutoScroll() {
            const btn = document.getElementById('btn-autoscroll');
            if(autoScrollInterval) {
                clearInterval(autoScrollInterval); autoScrollInterval = null;
                btn.classList.remove('bg-emerald-500', 'text-black'); btn.innerText = "‚á© AUTO";
            } else {
                autoScrollInterval = setInterval(() => window.scrollBy(0, 1), 40);
                btn.classList.add('bg-emerald-500', 'text-black'); btn.innerText = "‚àé STOP";
            }
        }

        function showSurahInfo() {
            if(!currentSurahData) return;
            document.getElementById('info-modal').classList.remove('hidden');
            document.getElementById('info-content').innerText = currentSurahData.tafsir.id || "Tidak ada data.";
        }

        // Init Data
        function init() {
            getSurahList();
            updateLastReadUI();
            setInterval(() => document.getElementById('jam-digital').innerText = new Date().toLocaleTimeString('id-ID'), 1000);
            // Sholat & Hijri fetch
            fetch(`https://api.myquran.com/v2/sholat/jadwal/1301/${new Date().getFullYear()}/${new Date().getMonth()+1}/${new Date().getDate()}`)
                .then(r=>r.json()).then(d=>{const j=d.data.jadwal; ['subuh','dzuhur','ashar','maghrib','isya'].forEach(k=>document.getElementById(`sholat-${k}`).innerText=j[k])});
            fetch(`https://api.aladhan.com/v1/gToH?date=${new Date().getDate()}-${new Date().getMonth()+1}-${new Date().getFullYear()}`)
                .then(r=>r.json()).then(d=>document.getElementById('hijri-now').innerText = `${d.data.hijri.day} ${d.data.hijri.month.en} ${d.data.hijri.year} H`);
        }
        
        // Zakat & Settings
        function openZakat(){document.getElementById('zakat-modal').classList.remove('hidden')}
        function hitungZakat(){ document.getElementById('zakat-result').innerText = "Zakat: Rp " + (document.getElementById('harta-val').value * 0.025).toLocaleString('id-ID'); }
        function changeFontSize(v){ config.fontSize=v; document.getElementById('font-val').innerText=v+'px'; document.querySelectorAll('.arabic').forEach(e=>e.style.fontSize=v+'px'); }
        function toggleSettingsMenu(){document.getElementById('settings-menu').classList.toggle('hidden')}
        function toggleFitur(){config.trans=document.getElementById('set-translate').checked; config.latin=document.getElementById('set-latin').checked; viewSurah(currentSurahId);}
        function toggleJumpAyat(){document.getElementById('jump-ayat-box').classList.toggle('hidden')}
        function doJump(){
             const t = document.getElementById(`ayat-box-${document.getElementById('input-ayat').value-1}`);
             if(t){ t.scrollIntoView({behavior:'smooth', block:'center'}); toggleJumpAyat(); }
        }
        function closeModal(id){document.getElementById(id).classList.add('hidden')}
        function openTasbih(){document.getElementById('tasbih-modal').classList.remove('hidden')}
        function countTasbih(){document.getElementById('tasbih-count').innerText = ++tasbihCount;}
        function resetTasbih(){tasbihCount=0; document.getElementById('tasbih-count').innerText=0;}
        async function openAsmaul(){ document.getElementById('asmaul-modal').classList.remove('hidden'); if(document.getElementById('asmaul-list').childElementCount==0){ const r=await fetch('https://api.aladhan.com/v1/asmaAlHusna'); const d=await r.json(); d.data.forEach(n=>document.getElementById('asmaul-list').innerHTML+=`<div class="glass p-2 text-center rounded"><p class="arabic text-lg text-emerald-400">${n.name}</p><p class="text-[9px]">${n.transliteration}</p></div>`) } }
        function openDoa(){ 
            document.getElementById('doa-modal').classList.remove('hidden'); 
            const c=document.getElementById('doa-list'); if(c.innerHTML!=='')return;
            [{t:"Makan",a:"ÿßŸéŸÑŸÑŸëŸ∞ŸáŸèŸÖŸéŸë ÿ®Ÿéÿßÿ±ŸêŸÉŸí ŸÑŸéŸÜŸéÿß...",l:"Allahumma barik..."},{t:"Tidur",a:"ÿ®Ÿêÿ≥ŸíŸÖŸêŸÉŸé ÿßŸÑŸÑŸëŸáŸèŸÖŸéŸë...",l:"Bismika..."}].forEach(d=>c.innerHTML+=`<div class="glass p-3 rounded"><p class="font-bold text-emerald-400">${d.t}</p><p class="arabic text-lg">${d.a}</p></div>`);
        }
        function searchSurah(){const q=document.getElementById('search-input').value.toLowerCase();renderSurahList(surahFullData.filter(s=>s.name.transliteration.id.toLowerCase().includes(q)))}
        function showHome(){stopAudio(); document.getElementById('detail-page').classList.add('hidden'); document.getElementById('home-page').classList.remove('hidden'); updateLastReadUI();}

        init();
    </script>
</body>
</html>
